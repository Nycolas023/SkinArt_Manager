--CREATE DATABASE SKINART

USE SKINART

CREATE TABLE USUARIO (
	ID_USUARIO INT PRIMARY KEY IDENTITY(1,1),
	NOME_USUARIO VARCHAR(200) NOT NULL,
	SOBRENOME_USUARIO VARCHAR(200) NOT NULL,
	DATA_NASC_USUARIO DATE NOT NULL,
	CPF_USUARIO VARCHAR(14) UNIQUE NOT NULL,
	RG_USUARIO VARCHAR(15) NOT NULL,
	LOGIN_USUARIO VARCHAR(200) UNIQUE NOT NULL,
	SENHA_USUARIO VARCHAR(200) NOT NULL,
	ALERGIA_USUARIO VARCHAR(300),
	AUTORIZACAO_MENOR_USUARIO BIT
);

GO

CREATE TABLE PAPEL (
	ID_PAPEL INT PRIMARY KEY IDENTITY(1,1),
	NOME_PAPEL VARCHAR(50) UNIQUE -- Ex: 'Admin', 'Tatuador', 'Cliente'
);

GO

CREATE TABLE USUARIO_PAPEL (
	ID_USUARIO INT NOT NULL,
	ID_PAPEL INT NOT NULL,
	PRIMARY KEY (ID_USUARIO, ID_PAPEL),
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
	FOREIGN KEY (ID_PAPEL) REFERENCES PAPEL(ID_PAPEL)
);

GO

CREATE TABLE TATUADOR (
	ID_USUARIO INT PRIMARY KEY,
	DESCRICAO_TATUADOR VARCHAR(500) NOT NULL,
	CNAE_FORMACAO_TATUADOR VARCHAR(100) NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

GO

CREATE TABLE ARTE_TATUADOR (
	ID_ARTE_TATUADOR INT PRIMARY KEY IDENTITY(1,1),
	ID_TATUADOR INT NOT NULL,
	IMAGEM_PATH_ARTE_TATUADOR VARCHAR(300) NOT NULL,
	DESC_ARTE_TATUADOR VARCHAR(200),
	FOREIGN KEY (ID_TATUADOR) REFERENCES TATUADOR(ID_USUARIO)
);

GO

CREATE TABLE AGENDAMENTO (
	ID_AGENDAMENTO INT PRIMARY KEY IDENTITY(1,1),
	DATA_AGENDAMENTO DATE NOT NULL,
	HORA_AGENDAMENTO TIME NOT NULL,
	ID_TATUADOR INT NOT NULL,
	ID_CLIENTE INT NOT NULL,
	FOREIGN KEY (ID_TATUADOR) REFERENCES USUARIO(ID_USUARIO),
	FOREIGN KEY (ID_CLIENTE) REFERENCES USUARIO(ID_USUARIO)
);

GO

CREATE TABLE PAGAMENTO
(
	ID_PAGAMENTO INT PRIMARY KEY IDENTITY(1,1),
	TIPO_PAGAMENTO VARCHAR(30) NOT NULL,
	DATA_PAGAMENTO DATE NOT NULL,
	HORA_PAGAMENTO TIME NOT NULL,
	PARCELAMENTO_PAGAMENTO TINYINT
)


GO

--============================== INSERT TESTE ==================================

INSERT INTO PAPEL(NOME_PAPEL)
VALUES ('CLIENTE'),
		('TATUADOR'),
		('ADMIN')

INSERT INTO USUARIO (NOME_USUARIO, SOBRENOME_USUARIO, LOGIN_USUARIO, SENHA_USUARIO, CPF_USUARIO, RG_USUARIO, DATA_NASC_USUARIO)
VALUES ('Carlos', 'Eduardo', 'carlos123', 'senha123', '123.456.789-00', '12.345.678-2x', GETDATE());

INSERT INTO TATUADOR (ID_USUARIO, DESCRICAO_TATUADOR, CNAE_FORMACAO_TATUADOR)
VALUES (1, 'Especialista em realismo', '9602501'); 

INSERT INTO USUARIO_PAPEL (ID_USUARIO, ID_PAPEL) VALUES (1, 2); -- Tatuador
INSERT INTO USUARIO_PAPEL (ID_USUARIO, ID_PAPEL) VALUES (1, 3); -- Admin


SELECT * FROM PAPEL ORDER BY ID_PAPEL
SELECT * FROM USUARIO

SELECT * FROM USUARIO_PAPEL
LEFT JOIN USUARIO
ON USUARIO.ID_USUARIO =	USUARIO_PAPEL.ID_USUARIO
LEFT JOIN PAPEL
ON PAPEL.ID_PAPEL = USUARIO_PAPEL.ID_PAPEL

--DROP TABLE IF EXISTS ARTE_TATUADOR;
--DROP TABLE IF EXISTS AGENDAMENTO;
--DROP TABLE IF EXISTS USUARIO_PAPEL;
--DROP TABLE IF EXISTS TATUADOR;
--DROP TABLE IF EXISTS PAGAMENTO;
--DROP TABLE IF EXISTS PAPEL;
--DROP TABLE IF EXISTS USUARIO;